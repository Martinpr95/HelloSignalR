<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Notificaciones con signalR</title>

    <!-- Bootstrap -->
    <link href="Content/bootstrap.min.css" rel="stylesheet" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <h1 class="page-header"><span>Saludar al Server</span></h1>
    <input id="btnSaludar" class="btn btn-primary" type="button" value="Saludar al Server" /><br /><br />
    <input id="btnActivo" class="btn btn-success" type="button" value="Estoy activo" /><br /><br />
    <input id="btnAburrido" class="btn btn-warning" type="button" value="Mirar otra cosa" /><br /><br />
    <input id="btnDesconectado" class="btn btn-danger" type="button" value="Cerrar sesión" />
    <input type="hidden" id="hidUsuario" value=""/>

    <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="Scripts/jquery.signalR-1.0.0.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>
    <script src="Scripts/bootstrap.min.js"></script>
    <script src="Scripts/bootstrap-notify.min.js"></script>

    <script src="sweetalert/sweetalert.min.js"></script>
    <link href="sweetalert/sweetalert.css" rel="stylesheet" />

    <script type="text/javascript">
        $(function () {
            // Declara un proxy para referenciar al Hub
            var chat = $.connection.notificationHub;
            //Por más que la clase en el server se llame ChatHub, y el método Send(), en JQuery va en camelCase.

            swal({
                title: "Atención!",
                text: "Escribe tu nombre de usuario:",
                type: "input",
                showCancelButton: false,
                closeOnConfirm: true,
                animation: "slide-from-top",
                inputPlaceholder: "Pepe"
            },
            function (inputValue) {
                $('#hidUsuario').val(inputValue);
                $('h1 span').text('Hola ' + inputValue + '!');
            });



            // Creás una función callback en el script. La clase Hub en el server,
            // llama a esta función para publicar actualizaciones de contenido a cada cliente
            chat.client.mostrarNotificacion = function (mensaje, tipo) {
                $.notify({
                    title: '<strong>Atención!</strong>',
                    message: mensaje
                }, {
                    type: tipo
                });
            };
            // Inicio la conexion!
            $.connection.hub.start().done(function () {
                $('#btnSaludar').click(function () {
                    // Al método Send() en el Hub
                    //en camelCase, a pesar de que se llame Send(string, string)
                    chat.server.hello($('#hidUsuario').val(), 'info', ' se conectó');
                });
                $('#btnActivo').click(function () {
                    // Al método Send() en el Hub
                    //en camelCase, a pesar de que se llame Send(string, string)
                    chat.server.hello($('#hidUsuario').val(), 'success', ' está activo');
                });
                $('#btnAburrido').click(function () {
                    // Al método Send() en el Hub
                    //en camelCase, a pesar de que se llame Send(string, string)
                    chat.server.hello($('#hidUsuario').val(), 'warning', ' no está prestando atención');
                });
                $('#btnDesconectado').click(function () {
                    // Al método Send() en el Hub
                    //en camelCase, a pesar de que se llame Send(string, string)
                    chat.server.hello($('#hidUsuario').val(), 'danger', ' se desconectó!');
                });
            });
        });
    </script>

</body>
</html>
